# Veriflite Data Portal 1.0.0 documentation

* Specification ID: `https://github.com/veriflite`

Websocket API for development of third party applications using Veriflite time of flight data.


## Table of Contents

* [Servers](#servers)
  * [device](#device-server)
* [Operations](#operations)
  * [SUB /raw](#sub-raw-operation)
  * [SUB /flight](#sub-flight-operation)
  * [PUB /sensor](#pub-sensor-operation)
  * [SUB /sensor](#sub-sensor-operation)

## Servers

### `device` Server

* URL: `ws://{ip}:4951`
* Protocol: `ws`

Data Portal running on the Veriflite App

#### URL Variables

| Name | Description | Default value | Allowed values |
|---|---|---|---|
| ip | The local network IP of the device running the Veriflite App
 | _None_ | _Any_ |


## Operations

### SUB `/raw` Operation

Stream of bluetooth packets as received by the app

Receive minimally processed data from the veriflite sensors as it arrives at the app.


#### Message `packet`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Minimally processed live data from the veriflite sensors as received by the app.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | packet | const (`"packet"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","sequenceNumber":11,"type":"IMPACT_TIME","data":9072}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor sending the packet | - | - | - |
| data.sequenceNumber | integer | Used to determine the order in which the packets were generated by the sensor | - | - | - |
| data.type | string | Sensor event described in this packet | allowed (`"IMPACT_SYNC"`, `"IMPACT_TIME"`, `"DEPART_SYNC"`, `"DEPART_TIME"`, `"IDLE_SYNC"`, `"IDLE_TIME"`, `"BATTERY_VOLTAGE"`) | - | - |
| data.data | integer | Sensor packet payload, either a timestamp or battery voltage (in mV) | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "packet",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "sequenceNumber": 11,
    "type": "IMPACT_TIME",
    "data": 9072
  }
}
```



### SUB `/flight` Operation

Stream of processed jump events for individual trampolines

Receive processed bounce data from the veriflite sensors as it arrives at the app.


Accepts **one of** the following messages:

#### Message `bounce`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Live individual bounce data after processing in the veriflite app. This event may be a new bounce, an update to an already received bounce or indicate an existing bounce has been found invalid and should be discarded.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | bounce | const (`"bounce"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","sequenceNumber":11,"timeOfFlight":1425,"toFDelta":45,"impactTimestamp":9072,"isInvalid":false}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor detecting the bounce | - | - | - |
| data.sequenceNumber | integer | Indicates the order of the bounce event relative to other events from the same sensor. This is the Sequence number of the IMPACT packet | - | - | - |
| data.timeOfFlight | integer | Difference in timestamps between an IMPACT and the preceeding DEPART | - | - | - |
| data.toFDelta | integer | Difference in time of flight bwteeen this and the preceeding bounce | - | - | - |
| data.impactTimestamp | integer | IMPACT timestamp received from the sensor | - | - | - |
| data.isInvalid | boolean | Marks this as an invalid bounce - it should be removed from use or ignored. Usually a result of laggy out of order data or false jumps due to reverberation. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "bounce",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "sequenceNumber": 11,
    "timeOfFlight": 1425,
    "toFDelta": 45,
    "impactTimestamp": 9072,
    "isInvalid": false
  }
}
```


#### Message `idle`

*Event signalling that a veriflite sensor has gone idle.*

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | idle | const (`"idle"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","sequenceNumber":12,"impactTimestamp":10352}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor sending the idle event | - | - | - |
| data.sequenceNumber | integer | Indicates the order of the idle event relative to other events from the same sensor. | - | - | - |
| data.idleTimestamp | integer | IDLE timestamp received from the sensor | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "idle",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "sequenceNumber": 12,
    "impactTimestamp": 10352
  }
}
```


#### Message `sensor-reset`

Event indicating that at least one of the veriflite sensors connected to the application has disconnected or reset. Expect sequence numbers following this to reset and caches to be discarded (there will be no updates to past jumps on missing data received).


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | sensor-reset | const (`"sensor-reset"`) | - | - |
| data | object | Placeholder for future development | - | - | **additional properties are allowed** |

> Examples of payload _(generated)_

```json
{
  "event": "sensor-reset",
  "data": null
}
```


#### Message `missing-data`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Event indicating that there are packets that were expected from the app that have either not arrived - meaning that jump data is unreliable, or that previously missing packets have arrived.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | missing-data | const (`"missing-data"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","missingSequenceNumbes":[8,10]}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor that the missing packets were detected on | - | - | - |
| data.missingSequenceNumbes | array<any> | List of currently missing sequence numbers. If this is empty it means that all missing packets have been found. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "missing-data",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "missingSequenceNumbes": [
      8,
      10
    ]
  }
}
```



### PUB `/sensor` Operation

Request sensor data and receive sensor events

Request information about the veriflite sensors known by the app


Accepts **one of** the following messages:

#### Message sensor-list request `sensor-request`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Request a list of the sensors known to the app. This consists of sensors that are either currently active or have been active since the data portal was started on the app.

This query will prompt a sensor-list response.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| request | string | sensor-list | const (`"sensor-list"`) | - | - |

> Examples of payload _(generated)_

```json
{
  "request": "sensor-list"
}
```


#### Message `sensor-data`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Request a summary of what the application knows about a specific sensor

This query will prompt a sensor-details response.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | examples (`{"request":"sensor-data","args":"90:FD:9F:AC:9B:7F"}`) | - | **additional properties are allowed** |
| request | string | sensor-details | const (`"sensor-details"`) | - | - |
| args | string | The address of a single known sensor. Use the sensor-list request to get a list of valid options. | - | - | - |

> Examples of payload

```json
{
  "request": "sensor-data",
  "args": "90:FD:9F:AC:9B:7F"
}
```



### SUB `/sensor` Operation

Request sensor data and receive sensor events

Receive information about the veriflite sensors known by the
app


Accepts **one of** the following messages:

#### Message `error`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Event exposing errors with the socket connection, requests or responses.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | error | const (`"error"`) | - | - |
| data | object | - | examples (`{"error":"InvalidArgument","message":"Could not find a sensor with the address \"90:FD:9F:AC:9B:7F\", request sensor-list for known sensors"}`) | - | **additional properties are allowed** |
| data.error | string | Type of error | - | - | - |
| data.message | string | Short description of the error | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "error",
  "data": {
    "error": "InvalidArgument",
    "message": "Could not find a sensor with the address \"90:FD:9F:AC:9B:7F\", request sensor-list for known sensors"
  }
}
```


#### Message sensor-list response `sensor-list`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

A list of the sensors known to the app. This consists of sensors that are either currently active or have been active since the data portal was started on the app.

This is a response to the sensor-list query.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | sensor-list | const (`"sensor-list"`) | - | - |
| data | object | - | examples (`{"sensors":["90:FD:9F:AC:9B:7F","CC:CC:CC:9B:D8:FD"]}`) | - | **additional properties are allowed** |
| data.sensors | array<any> | List of sensors that have been seen by the app while the data portal has been active. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "sensor-list",
  "data": {
    "sensors": [
      "90:FD:9F:AC:9B:7F",
      "CC:CC:CC:9B:D8:FD"
    ]
  }
}
```


#### Message `sensor-details`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

A summary of what the application knows about a specific sensor

This is a response to the sensor-list query.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | sensor-details | const (`"sensor-details"`) | - | - |
| data | object | - | examples (`{"friendlyName":"Trampoline 1","firmwareVersion":"1.13.3","batteryLevel":1503,"isPaired":false,"syncID":-1,"bootNumber":173,"lifetimeJumps":4542,"lifetimeAge":188678,"uniqueID":844383776,"advertisingRate":13.0791388,"isHighPower":false}`) | - | **additional properties are allowed** |
| data.friendlyName | string | User friendly name given to the sensor and displayed throughout Veriflite | - | - | - |
| data.firmwareVersion | string | Firmware version running on the sensor | - | - | - |
| data.batteryLevel | integer | Battery voltage in mV | - | - | - |
| data.isPaired | boolean | Whether the sensor is paired (and clock synced) with another sensor. Useful for synchro calculations. | - | - | - |
| data.syncID | integer | Given to a sensor for synchro pairing. Sensors will attempt to pair with others on the same sync ID | - | - | - |
| data.bootNumber | integer | Number of times the sensor has been booted up in its lifetime. | - | - | - |
| data.lifetimeJumps | integer | Total number of bounce events sent by the sensor in its lifetime | - | - | - |
| data.lifetimeAge | integer | Total time the sensor has been active in its lifetime, measured in seconds | - | - | - |
| data.uniqueID | integer | A uinque ID number for a given sensor | - | - | - |
| data.advertisingRate | number | Rate at which packets from the sensor are recieved by the app - indicates the strength of the signal from the sensor to app. | - | - | - |
| data.isHighPower | boolean | Whether the sensor is in high power mode (sending out packets at a higher rate). | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "sensor-details",
  "data": {
    "friendlyName": "Trampoline 1",
    "firmwareVersion": "1.13.3",
    "batteryLevel": 1503,
    "isPaired": false,
    "syncID": -1,
    "bootNumber": 173,
    "lifetimeJumps": 4542,
    "lifetimeAge": 188678,
    "uniqueID": 844383776,
    "advertisingRate": 13.0791388,
    "isHighPower": false
  }
}
```


#### Message `battery`

*Battery level updates recieved from the sensors.*

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | battery | const (`"battery"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","batteryLevel":1503}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor sending the battery level report | - | - | - |
| data.batteryLevel | integer | Battery voltage in mV | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "battery",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "batteryLevel": 1503
  }
}
```


#### Message `status-flags`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Status flags recieved from a sensor providing firmware information.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | status-flags | const (`"status-flags"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","uniqueID":844383776,"firmwareVersion":"1.13.3","isHighPower":false,"bootNumber":134,"lifetimeJumps":4542,"lifetimeAge":188678}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor sending the status report | - | - | - |
| data.uniqueID | integer | A uinque ID number for a given sensor | - | - | - |
| data.firmwareVersion | string | Firmware version running on the sensor | - | - | - |
| data.isHighPower | boolean | Whether the sensor is in high power mode (sending out packets at a higher rate). | - | - | - |
| data.bootNumber | integer | Number of times the sensor has been booted up in its lifetime. | - | - | - |
| data.lifetimeJumps | integer | Total number of bounce events sent by the sensor in its lifetime | - | - | - |
| data.lifetimeAge | integer | Total time the sensor has been active in its lifetime, measured in seconds | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "status-flags",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "uniqueID": 844383776,
    "firmwareVersion": "1.13.3",
    "isHighPower": false,
    "bootNumber": 134,
    "lifetimeJumps": 4542,
    "lifetimeAge": 188678
  }
}
```


#### Message `display-name`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Event indicating that a sensor has sent the user-friendly display name given to it.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | display-name | const (`"display-name"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","friendlyName":"Trampoline 1"}`) | - | **additional properties are allowed** |
| data.address | string | Address of the sensor reporting its name | - | - | - |
| data.friendlyName | string | User friendly name given to the sensor and displayed throughout Veriflite | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "display-name",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "friendlyName": "Trampoline 1"
  }
}
```



