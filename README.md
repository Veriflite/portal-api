# Veriflite Portal 0.1-6-gb6d1a2f documentation

* Specification ID: `https://github.com/veriflite/portal-api`
* Email support: [john@veriflite.com](mailto:john@veriflite.com)

The Veriflite Portal allows developers direct access to Veriflite's Time of Flight data, to create custom applications on top of the Veriflite platform.

The Portal uses websockets for communication and has three endpoints available: /raw, /flight, and /sensor. The /raw endpoint publishes unprocessed bounce data, while the /flight endpoint publishes processed data. The /sensor endpoint responds to requests for information about the active sensors.

To get started you can use a tool such as websocat, available at https://github.com/vi/websocat, to connect to the endpoints. For example to observe raw bounce data, start the Veriflite app and go to Labs -> Portal; then on your PC, substituting for the IP address displayed in the Portal, run the following command and you should see a stream of bounce events depending on the activity on your trampoline:

    websocat ws://192.168.1.95:4651/raw

There are also some simple example Python projects available at https://github.com/Veriflite/Portal-Demo that demonstrate how to receive Veriflite data.

Please let us know if you're trying the Portal out, we are keen to hear how you get on!


## Table of Contents

* [Servers](#servers)
  * [device](#device-server)
* [Operations](#operations)
  * [SUB /raw](#sub-raw-operation)
  * [SUB /flight](#sub-flight-operation)
  * [PUB /sensor](#pub-sensor-operation)
  * [SUB /sensor](#sub-sensor-operation)

## Servers

### `device` Server

* URL: `ws://{ip}:4951`
* Protocol: `ws`

A websocket connection must be opened to the URI displayed by the Veriflite app.

#### URL Variables

| Name | Description | Default value | Allowed values |
|---|---|---|---|
| ip | The IP address of the device running the Veriflite app.
 | _None_ | _Any_ |


## Operations

### SUB `/raw` Operation

Open a connection to the /raw endpoint to receive unprocessed bounce events in the form of landing and depart timestamps.


#### Message `packet`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Minimally processed live data from the Veriflite sensors as received by the app.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | packet | const (`"packet"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","sequenceNumber":11,"type":"IMPACT_TIME","data":9072}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.sequenceNumber | integer | Used to determine the order in which the packets were generated by the sensor. | - | - | - |
| data.type | string | Sensor event described in this packet. The _SYNC suffix indicates that the sensor has synchronised its clock with another sensor, and the timestamp values may be used for calculating a synchro score, whereas the _TIME suffix indicates that it is not a synchronised value. | allowed (`"IMPACT_SYNC"`, `"IMPACT_TIME"`, `"DEPART_SYNC"`, `"DEPART_TIME"`, `"IDLE_SYNC"`, `"IDLE_TIME"`, `"BATTERY_VOLTAGE"`) | - | - |
| data.data | integer | Sensor packet payload, either a timestamp (ms) or battery voltage (mV). | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "packet",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "sequenceNumber": 11,
    "type": "IMPACT_TIME",
    "data": 9072
  }
}
```



### SUB `/flight` Operation

Processed bounce events.

Receive processed bounce data from the Veriflite sensors as it arrives at the app.


Accepts **one of** the following messages:

#### Message `bounce`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Live individual bounce data after processing in the Veriflite app. This event may be a new bounce, an update to an already received bounce or indicate an existing bounce has been found invalid and should be discarded.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | bounce | const (`"bounce"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","sequenceNumber":11,"timeOfFlight":1425,"toFDelta":45,"impactTimestamp":9072,"isInvalid":false}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.sequenceNumber | integer | The order of the bounce event relative to other events from the same sensor. This value corresponds to the sequence number of the IMPACT packet which ends the flight phase of the bounce. Note - This sequence will not be contiguous. | - | - | - |
| data.timeOfFlight | integer | Duration (ms) from DEPART to IMPACT event timestamps. | - | - | - |
| data.toFDelta | integer | Difference (ms) in timeOfFlight from the previous bounce. | - | - | - |
| data.impactTimestamp | integer | Timestamp (ms) of the IMPACT event which ends the flight phase. | - | - | - |
| data.isInvalid | boolean | Indicates that a bounceData packet which was previously broadcast is now determined to be invalid and should be discarded. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "bounce",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "sequenceNumber": 11,
    "timeOfFlight": 1425,
    "toFDelta": 45,
    "impactTimestamp": 9072,
    "isInvalid": false
  }
}
```


#### Message `idle`

*Event signalling that a Veriflite sensor has gone idle.*

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | idle | const (`"idle"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","sequenceNumber":12,"impactTimestamp":10352}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.sequenceNumber | integer | The order of the idle event relative to other events from the same sensor. | - | - | - |
| data.idleTimestamp | integer | Timestamp (ms) of the IDLE event. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "idle",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "sequenceNumber": 12,
    "impactTimestamp": 10352
  }
}
```


#### Message `sensor-reset`

Event indicating that at least one of the Veriflite sensors connected to the application has disconnected or reset. Expect sequence numbers following this to reset and caches to be discarded (there will be no updates to past jumps on missing data received).


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | sensor-reset | const (`"sensor-reset"`) | - | - |
| data | object | Placeholder for future development | - | - | **additional properties are allowed** |

> Examples of payload _(generated)_

```json
{
  "event": "sensor-reset",
  "data": null
}
```


#### Message `missing-data`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Event indicating that there are packets that were expected from the app that have either not arrived - meaning that jump data is unreliable, or that previously missing packets have arrived.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | The app has detected it is missing some data from the sensors. | const (`"missing-data"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","missingSequenceNumbes":[8,10]}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.missingSequenceNumbes | array<any> | List of currently missing sequence numbers. If this is empty it means that all previously missing packets have been found. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "missing-data",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "missingSequenceNumbes": [
      8,
      10
    ]
  }
}
```



### PUB `/sensor` Operation

Request sensor data and receive sensor events.

Request information about the Veriflite sensors known by the app.


Accepts **one of** the following messages:

#### Message `sensor-request`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Request a list of the sensors known to the app. This consists of sensors that are either currently active or have been active since the Portal was started on the app.

This query will prompt a sensor-list response.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| request | string | sensor-list | const (`"sensor-list"`) | - | - |

> Examples of payload _(generated)_

```json
{
  "request": "sensor-list"
}
```


#### Message `sensor-data`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Request a summary of what the application knows about a specific sensor.

This query will prompt a sensor-details response.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | examples (`{"request":"sensor-data","args":"90:FD:9F:AC:9B:7F"}`) | - | **additional properties are allowed** |
| request | string | sensor-details | const (`"sensor-details"`) | - | - |
| args | string | The address of a known sensor. Use the sensor-list request to get a list of valid options. | - | - | - |

> Examples of payload

```json
{
  "request": "sensor-data",
  "args": "90:FD:9F:AC:9B:7F"
}
```



### SUB `/sensor` Operation

Request sensor data and receive sensor events.

Receive information about the Veriflite sensors known by the app.


Accepts **one of** the following messages:

#### Message `error`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Event exposing errors with the socket connection, requests or responses.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | error | const (`"error"`) | - | - |
| data | object | - | examples (`{"error":"InvalidArgument","message":"Could not find a sensor with the address \"90:FD:9F:AC:9B:7F\", request sensor-list for known sensors."}`) | - | **additional properties are allowed** |
| data.error | string | Type of error | - | - | - |
| data.message | string | Short description of the error | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "error",
  "data": {
    "error": "InvalidArgument",
    "message": "Could not find a sensor with the address \"90:FD:9F:AC:9B:7F\", request sensor-list for known sensors."
  }
}
```


#### Message `sensor-list`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

A list of the sensors known to the app. This consists of sensors that are either currently active or have been active since the Portal was started on the app.

This is a response to the sensor-list query.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | sensor-list | const (`"sensor-list"`) | - | - |
| data | object | - | examples (`{"sensors":["90:FD:9F:AC:9B:7F","CC:CC:CC:9B:D8:FD"]}`) | - | **additional properties are allowed** |
| data.sensors | array<any> | List of sensors that have been seen by the app while the Portal has been active. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "sensor-list",
  "data": {
    "sensors": [
      "90:FD:9F:AC:9B:7F",
      "CC:CC:CC:9B:D8:FD"
    ]
  }
}
```


#### Message `sensor-details`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

A summary of what the app knows about a specific sensor.

This is a response to the sensor-list query.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | sensor-details | const (`"sensor-details"`) | - | - |
| data | object | - | examples (`{"friendlyName":"Trampoline 1","firmwareVersion":"1.13.3","batteryLevel":1503,"isPaired":false,"syncID":-1,"bootNumber":173,"lifetimeJumps":4542,"lifetimeAge":188678,"uniqueID":844383776,"advertisingRate":13.0791388,"isHighPower":false}`) | - | **additional properties are allowed** |
| data.friendlyName | string | User friendly name given to the sensor and displayed throughout Veriflite | - | - | - |
| data.firmwareVersion | string | Firmware version running on the sensor | - | - | - |
| data.batteryLevel | integer | Battery voltage in mV | - | - | - |
| data.isPaired | boolean | Whether the sensor is paired (and clock synced) with another sensor. Useful for synchro calculations. | - | - | - |
| data.syncID | integer | Given to a sensor for synchro pairing. Sensors will attempt to pair with others on the same sync ID. | - | - | - |
| data.bootNumber | integer | Number of times the sensor has been booted up in its lifetime. | - | - | - |
| data.lifetimeJumps | integer | Total number of bounce events sent by the sensor in its lifetime. | - | - | - |
| data.lifetimeAge | integer | Total time the sensor has been active in its lifetime, measured in seconds. | - | - | - |
| data.uniqueID | integer | A unique ID number for a given sensor. | - | - | - |
| data.advertisingRate | number | Rate at which packets from the sensor are received by the app - indicates the strength of the signal from the sensor to app. | - | - | - |
| data.isHighPower | boolean | Whether the sensor is in high power mode (sending out packets at a higher rate). | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "sensor-details",
  "data": {
    "friendlyName": "Trampoline 1",
    "firmwareVersion": "1.13.3",
    "batteryLevel": 1503,
    "isPaired": false,
    "syncID": -1,
    "bootNumber": 173,
    "lifetimeJumps": 4542,
    "lifetimeAge": 188678,
    "uniqueID": 844383776,
    "advertisingRate": 13.0791388,
    "isHighPower": false
  }
}
```


#### Message `battery`

*Current sensor battery level (mV)*

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | battery | const (`"battery"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","batteryLevel":1503}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.batteryLevel | integer | Battery voltage in mV | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "battery",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "batteryLevel": 1503
  }
}
```


#### Message `status-flags`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Status flags received from a sensor providing firmware information.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | status-flags | const (`"status-flags"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","uniqueID":844383776,"firmwareVersion":"1.13.3","isHighPower":false,"bootNumber":134,"lifetimeJumps":4542,"lifetimeAge":188678}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.uniqueID | integer | A unique ID number for a given sensor. | - | - | - |
| data.firmwareVersion | string | Firmware version running on the sensor. | - | - | - |
| data.isHighPower | boolean | Whether the sensor is in high power mode (sending out packets at a higher rate). | - | - | - |
| data.bootNumber | integer | Number of times the sensor has been booted up in its lifetime. | - | - | - |
| data.lifetimeJumps | integer | Total number of bounce events ever detected by the sensor. | - | - | - |
| data.lifetimeAge | integer | Total time the sensor has been active in its lifetime, measured in seconds. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "status-flags",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "uniqueID": 844383776,
    "firmwareVersion": "1.13.3",
    "isHighPower": false,
    "bootNumber": 134,
    "lifetimeJumps": 4542,
    "lifetimeAge": 188678
  }
}
```


#### Message `display-name`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

Event indicating that a sensor has sent the user-friendly display name given to it.


##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| event | string | display-name | const (`"display-name"`) | - | - |
| data | object | - | examples (`{"address":"90:FD:9F:AC:9B:7F","friendlyName":"Trampoline 1"}`) | - | **additional properties are allowed** |
| data.address | string | Unique sensor identifier. | - | - | - |
| data.friendlyName | string | User friendly name given to the sensor and displayed throughout Veriflite. | - | - | - |

> Examples of payload _(generated)_

```json
{
  "event": "display-name",
  "data": {
    "address": "90:FD:9F:AC:9B:7F",
    "friendlyName": "Trampoline 1"
  }
}
```



